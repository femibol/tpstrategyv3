<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TP Strategy Pro v5.0 - Ultimate Trading Platform</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiVFAgU3RyYXRlZ3kgUHJvIHY1LjAiLCJzaG9ydF9uYW1lIjoiVWx0aW1hdGVUcmFkZXIiLCJkZXNjcmlwdGlvbiI6IlVsdGltYXRlIFRyYWRpbmcgUGxhdGZvcm0gd2l0aCBBSSIsInN0YXJ0X3VybCI6Ii8iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjMGQxMTE3IiwidGhlbWVfY29sb3IiOiIjMjM4NjM2IiwiaWNvbnMiOlt7InNyYyI6ImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjNhV1IwYUQwaU1qUXdJaUJvWldsbmFIUTlJakkwTUNJZ2RtbGxkMEp2ZUQwaU1DQXdJakkwTUNBeU5EQWlJSGh0Ykc1elBTSm9kSFJ3T2k4dmQzZDNMbmN6TG05eVp5OHlNREF3TDNOMlp5SStQSEpsWTNRZ2VEMGlOREFpSUhrOUlqUXdJaUIzYVdSMGFEMGlNVFl3SWlCb1pXbG5hSFE5SWpFMk1DSWdabWxzYkQwaUl6SXpPRFkwTmlJdlBqeDBaWGgwSUhnOUlqRXlNQ0lnZVQwaU1USTBJaUJtYVd4c1BTSWpabVF3YmpkaVl5SWdabTl1ZEMxbVlXMXBiSGs5SW0xdmJtOXpjR0ZqWlNJZ1ptOXVkQzF6YVhwbFBTSXpNQ0lnZG1Gc2FXZHVMV0poYzJWc2FXNWxQU0p0YVdSa2JHVWlQa2xCTzBBOEwzUmxlSFErUEM5emRtYytJaUJ6YVhwbGN6MGlNall6ZUdNek9ESWlJSFI1Y0dVOUlrbHRZV2RsSWl3aWMzSmpJam9pWkdGMFlUcHBiV0ZuWlM5emRtY3JlRzFzTzJKaGMyVTJOQ3ciLCJzaXplcyI6IjI0MHgyNDAiLCJ0eXBlIjoiaW1hZ2Uvc3ZnK3htbCJ9XX0=">
    
    <!-- Meta tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="UltimateTrader">
    <meta name="theme-color" content="#238636">
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #0d1117;
            color: #f0f6fc;
            margin: 0;
            padding: 0;
        }

        .header {
            background: linear-gradient(135deg, #1f2937, #374151);
            border-bottom: 1px solid #30363d;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            font-size: 1.2rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-indicators {
            display: flex;
            gap: 0.5rem;
            font-size: 0.8rem;
            align-items: center;
        }

        .status-online { color: #238636; }
        .status-offline { color: #da3633; }
        .status-loading { color: #ffd700; }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 1rem;
        }

        .upload-zone {
            border: 2px dashed #30363d;
            border-radius: 8px;
            padding: 2rem 1rem;
            text-align: center;
            cursor: pointer;
            margin: 1rem 0;
            background: #161b22;
            transition: all 0.3s;
        }

        .upload-zone:hover {
            border-color: #58a6ff;
            background: rgba(88, 166, 255, 0.05);
        }

        .upload-zone.dragover {
            border-color: #238636;
            background: rgba(35, 134, 54, 0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .stat-card {
            background: #21262d;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 0.8rem;
            text-align: center;
            position: relative;
        }

        .stat-number {
            font-size: 1.2rem;
            font-weight: bold;
            color: #58a6ff;
        }

        .stat-label {
            font-size: 0.7rem;
            color: #8b949e;
        }

        .filters {
            display: flex;
            gap: 0.5rem;
            margin: 1rem 0;
            flex-wrap: wrap;
            align-items: center;
        }

        .btn {
            background: #238636;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 0.4rem 0.8rem;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s;
        }

        .btn:hover {
            background: #2ea043;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #21262d;
            border: 1px solid #30363d;
        }

        .btn-secondary:hover {
            background: #30363d;
        }

        .btn-api {
            background: #1f6feb;
            border: 1px solid #1f6feb;
        }

        .btn-api:hover {
            background: #1a56db;
        }

        .btn-danger {
            background: #da3633;
            border: 1px solid #da3633;
        }

        .btn-danger:hover {
            background: #f85149;
        }

        .btn-ml {
            background: #a855f7;
            border: 1px solid #a855f7;
        }

        .btn-ml:hover {
            background: #9333ea;
        }

        .btn-social {
            background: #fb8500;
            border: 1px solid #fb8500;
        }

        .btn-social:hover {
            background: #fd7e14;
        }

        select, input {
            background: #0d1117;
            color: #f0f6fc;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 0.4rem;
            min-width: 120px;
            font-size: 0.8rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            font-size: 0.75rem;
        }

        th, td {
            text-align: left;
            padding: 0.3rem;
            border-bottom: 1px solid #30363d;
            white-space: nowrap;
        }

        th {
            background: #161b22;
            font-weight: 600;
            position: sticky;
            top: 0;
            cursor: pointer;
            user-select: none;
        }

        th:hover {
            background: #21262d;
        }

        tr:hover {
            background: #161b22;
        }

        .table-wrapper {
            overflow-x: auto;
            max-height: 600px;
            border: 1px solid #30363d;
            border-radius: 8px;
        }

        .positive { color: #238636; }
        .negative { color: #da3633; }
        .neutral { color: #8b949e; }

        .signal-badge {
            padding: 0.15rem 0.3rem;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.65rem;
            white-space: nowrap;
        }

        .momentum-buy { background: #238636; color: white; }
        .pullback-buy { background: #1f6feb; color: white; }
        .momentum-forming { background: #ffd700; color: black; }
        .volume-surge { background: #fb8500; color: white; }
        .consolidating { background: #a855f7; color: white; }
        .uptrend-no-setup { background: #8b949e; color: white; }
        .no-setup { background: #30363d; color: #8b949e; }

        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            border-bottom: 1px solid #30363d;
            overflow-x: auto;
        }

        .tab {
            padding: 0.5rem 1rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            color: #8b949e;
            white-space: nowrap;
            font-size: 0.85rem;
        }

        .tab.active {
            color: #f0f6fc;
            border-bottom-color: #58a6ff;
        }

        .tab:hover {
            color: #f0f6fc;
        }

        .tab-content {
            display: none;
        }

        .info-box {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }

        #resultsSection {
            display: none;
        }

        .file-list {
            margin: 1rem 0;
            padding: 1rem;
            background: #161b22;
            border-radius: 8px;
            border: 1px solid #30363d;
        }

        /* Achievement System */
        .achievement-popup {
            position: fixed;
            top: 80px;
            right: 20px;
            background: linear-gradient(135deg, #ffd700, #ffed4a);
            color: #000;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(255, 215, 0, 0.3);
            z-index: 1000;
            animation: achievementSlide 0.5s ease-out;
            max-width: 300px;
        }

        @keyframes achievementSlide {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .achievement-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        /* Chat Bot Styles */
        .chatbot-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 350px;
            height: 400px;
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 12px;
            display: none;
            flex-direction: column;
            z-index: 1000;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
        }

        .chatbot-header {
            background: linear-gradient(135deg, #238636, #2ea043);
            color: white;
            padding: 1rem;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chatbot-messages {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            max-height: 250px;
        }

        .chatbot-input {
            padding: 1rem;
            border-top: 1px solid #30363d;
            display: flex;
            gap: 0.5rem;
        }

        .chatbot-input input {
            flex: 1;
            padding: 0.5rem;
            border: 1px solid #30363d;
            border-radius: 6px;
            background: #0d1117;
            color: #f0f6fc;
        }

        .chat-message {
            margin-bottom: 1rem;
            padding: 0.5rem;
            border-radius: 8px;
            max-width: 80%;
        }

        .chat-message.user {
            background: #1f6feb;
            color: white;
            margin-left: auto;
        }

        .chat-message.bot {
            background: #21262d;
            color: #f0f6fc;
        }

        .chatbot-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #238636, #2ea043);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 999;
            box-shadow: 0 4px 20px rgba(35, 134, 54, 0.3);
            transition: all 0.3s;
        }

        .chatbot-toggle:hover {
            transform: scale(1.1);
        }

        /* Social Features */
        .social-panel {
            background: #161b22;
            border: 1px solid #fb8500;
            border-radius: 8px;
            margin: 1rem 0;
            padding: 1rem;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #238636, #2ea043);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .user-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin: 1rem 0;
        }

        .user-stat {
            text-align: center;
            padding: 0.5rem;
            background: #21262d;
            border-radius: 6px;
        }

        .achievement-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            margin: 0.25rem;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .badge-bronze { background: #cd7f32; color: white; }
        .badge-silver { background: #c0c0c0; color: black; }
        .badge-gold { background: #ffd700; color: black; }
        .badge-platinum { background: #e5e4e2; color: black; }

        /* Paper Trading */
        .paper-trading {
            background: #161b22;
            border: 1px solid #1f6feb;
            border-radius: 8px;
            margin: 1rem 0;
            padding: 1rem;
        }

        .portfolio-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .position-card {
            background: #21262d;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 0.8rem;
        }

        /* Webhook Status */
        .webhook-status {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .webhook-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }

        .webhook-connected { background: #238636; }
        .webhook-disconnected { background: #da3633; }

        /* Charts Container */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .chart-container {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 1rem;
            position: relative;
            height: 300px;
        }

        .chart-title {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #f0f6fc;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 0.5rem;
            }
            
            .logo {
                font-size: 1rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-container {
                height: 250px;
            }
            
            .chatbot-container {
                width: 300px;
                height: 350px;
                bottom: 90px;
            }
            
            .filters {
                gap: 0.3rem;
            }
            
            select, input {
                min-width: 100px;
                font-size: 0.75rem;
            }
            
            table {
                font-size: 0.7rem;
            }
        }

        /* Offline indicator */
        .offline-banner {
            background: #da3633;
            color: white;
            text-align: center;
            padding: 0.5rem;
            display: none;
        }

        /* Loading states */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #30363d;
            border-radius: 50%;
            border-top-color: #58a6ff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Install prompt */
        .install-prompt {
            background: #238636;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            font-size: 0.8rem;
            margin-left: 0.5rem;
            display: none;
        }

        .install-prompt:hover {
            background: #2ea043;
        }
    </style>
</head>
<body>
    <div class="offline-banner" id="offlineBanner">
        üì± You're offline. Some features may be limited.
    </div>

    <div class="header">
        <div class="logo">
            <span>üöÄ</span>
            <span>TP Strategy Pro v5.0 - Ultimate Trading Platform</span>
        </div>
        <div class="status-indicators">
            <span id="apiStatus" class="status-offline">üì° API: Offline</span>
            <span id="webhookStatus" class="status-offline">üîó Webhooks: Off</span>
            <span id="dataStatus" class="status-online">üíæ Data: Ready</span>
            <button class="install-prompt" id="installBtn">üì± Install</button>
        </div>
    </div>

    <div class="container">
        <!-- Tabs Navigation -->
        <div class="tabs">
            <div class="tab active" onclick="showTab('analysis')">üìä Analysis</div>
            <div class="tab" onclick="showTab('realtime')">üì° Real-time</div>
            <div class="tab" onclick="showTab('charts')">üìà Charts</div>
            <div class="tab" onclick="showTab('social')">üë• Social</div>
            <div class="tab" onclick="showTab('paper')">üí∞ Paper Trading</div>
            <div class="tab" onclick="showTab('automation')">ü§ñ Automation</div>
            <div class="tab" onclick="showTab('history')">üóÑÔ∏è History</div>
            <div class="tab" onclick="showTab('ml')">üß† ML Analytics</div>
        </div>

        <!-- Analysis Tab -->
        <div id="analysisTab" class="tab-content">
            <div class="info-box">
                <strong>üöÄ TP Strategy Pro v5.0 - Ultimate Trading Platform:</strong>
                <div style="margin-top: 0.5rem; font-size: 0.875rem;">
                    <strong>New v5.0 Ultimate Features:</strong>
                    <ul style="margin: 0.5rem 0;">
                        <li><strong>ü§ñ AI Trading Chatbot</strong> - Ask questions about any stock</li>
                        <li><strong>üë• Social Trading</strong> - Share signals with community</li>
                        <li><strong>üèÜ Gamification</strong> - Earn achievements and badges</li>
                        <li><strong>üí∞ Paper Trading</strong> - Practice with virtual portfolio</li>
                        <li><strong>üîó TradersPost Integration</strong> - Auto-execute trades</li>
                        <li><strong>üìã TradingView Export</strong> - Export watchlists seamlessly</li>
                        <li><strong>‚ö° Advanced Automation</strong> - Smart webhooks and alerts</li>
                    </ul>
                    <strong>üéÆ Click the chat bot to start trading with AI assistance!</strong>
                </div>
            </div>

            <div class="upload-zone" id="uploadZone">
                <input type="file" id="csvFile" style="display: none;" accept=".csv" multiple />
                <div style="margin-bottom: 1rem;">
                    <span style="font-size: 1.5rem;">üöÄ</span>
                </div>
                <p style="font-size: 1rem; margin: 0;">Drop CSV files here or click to browse</p>
                <p style="color: #8b949e; margin-top: 0.5rem;">Ultimate Trading Platform ‚Ä¢ AI ‚Ä¢ Social ‚Ä¢ Automation</p>
            </div>

            <div id="fileList" class="file-list" style="display: none;"></div>

            <div id="resultsSection">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalStocks">0</div>
                        <div class="stat-label">Total Stocks</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: #238636;" id="buySignals">0</div>
                        <div class="stat-label">Buy Signals</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: #58a6ff;" id="strongStocks">0</div>
                        <div class="stat-label">Strong Stocks</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: #ffd700;" id="highGrade">0</div>
                        <div class="stat-label">A-B Grades</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: #a855f7;" id="historyCount">0</div>
                        <div class="stat-label">Uploads</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: #1f6feb;" id="realTimeSymbols">0</div>
                        <div class="stat-label">Live Tracked</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: #fb8500;" id="socialShares">0</div>
                        <div class="stat-label">Shared Signals</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: #2ea043;" id="paperValue">$10,000</div>
                        <div class="stat-label">Paper Portfolio</div>
                    </div>
                </div>

                <div class="filters">
                    <input type="text" id="searchBox" placeholder="Search symbols..." />
                    <select id="signalFilter">
                        <option value="">All Signals</option>
                        <option value="MOMENTUM BUY">üü¢ Momentum Buy</option>
                        <option value="PULLBACK BUY">üîµ Pullback Buy</option>
                        <option value="MOMENTUM FORMING">üü° Momentum Forming</option>
                        <option value="VOLUME SURGE">üü† Volume Surge</option>
                        <option value="CONSOLIDATING">üü£ Consolidating</option>
                        <option value="UPTREND - NO SETUP">‚ö™ Uptrend - No Setup</option>
                        <option value="NO SETUP">‚ö´ No Setup</option>
                    </select>
                    <select id="strengthFilter">
                        <option value="">All Strengths</option>
                        <option value="Strong">Strong</option>
                        <option value="Bullish">Bullish</option>
                        <option value="Neutral">Neutral</option>
                        <option value="Bearish">Bearish</option>
                        <option value="Weak">Weak</option>
                    </select>
                    <button class="btn" onclick="applyFilters()">Apply</button>
                    <button class="btn btn-secondary" onclick="clearFilters()">Clear</button>
                    <button class="btn btn-api" onclick="RealTimeAPI.refreshAllPrices()">üîÑ Refresh</button>
                    <button class="btn btn-social" onclick="SocialAPI.shareTopSignals()">üì§ Share Top</button>
                    <button class="btn btn-ml" onclick="TradingViewAPI.exportWatchlist()">üìã Export TV</button>
                </div>

                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th onclick="sortTable('rank')">Rank ‚Üï</th>
                                <th onclick="sortTable('symbol')">Symbol ‚Üï</th>
                                <th>Charts</th>
                                <th onclick="sortTable('signal')">Signal ‚Üï</th>
                                <th onclick="sortTable('strength')">Strength ‚Üï</th>
                                <th onclick="sortTable('grade')">Grade ‚Üï</th>
                                <th onclick="sortTable('price')">Price ‚Üï</th>
                                <th onclick="sortTable('change')">Change % ‚Üï</th>
                                <th onclick="sortTable('score')">Score ‚Üï</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="stockTable"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Real-time Tab -->
        <div id="realtimeTab" class="tab-content" style="display: none;">
            <div class="info-box">
                <h3>üì° Real-time Market Data</h3>
                <div style="display: flex; gap: 0.5rem; margin: 1rem 0;">
                    <button class="btn btn-api" onclick="RealTimeAPI.addSymbolToTracking()">‚ûï Add Symbol</button>
                    <button class="btn btn-secondary" onclick="RealTimeAPI.refreshAllPrices()">üîÑ Refresh All</button>
                    <button class="btn btn-secondary" onclick="RealTimeAPI.toggleAutoRefresh()">‚è±Ô∏è Auto Refresh</button>
                    <button class="btn btn-social" onclick="WebhookAPI.testTradersPost()">üîó Test TradersPost</button>
                </div>
            </div>
            
            <div class="webhook-status">
                <h4>üîó Webhook Status</h4>
                <div>
                    <span class="webhook-indicator webhook-disconnected"></span>
                    <span>TradersPost: Disconnected</span>
                    <button class="btn btn-secondary" onclick="WebhookAPI.configureTradersPost()" style="margin-left: 1rem;">Configure</button>
                </div>
                <div style="margin-top: 0.5rem;">
                    <span class="webhook-indicator webhook-disconnected"></span>
                    <span>Discord: Disconnected</span>
                    <button class="btn btn-secondary" onclick="WebhookAPI.configureDiscord()" style="margin-left: 1rem;">Configure</button>
                </div>
            </div>
            
            <div class="stats-grid" id="realTimeGrid">
                <!-- Real-time price cards will be populated here -->
            </div>
        </div>

        <!-- Charts Tab -->
        <div id="chartsTab" class="tab-content" style="display: none;">
            <div style="margin-bottom: 1rem;">
                <h3>üìà Interactive Charts & Analytics</h3>
                <div style="display: flex; gap: 0.5rem; margin: 1rem 0;">
                    <button class="btn btn-secondary" onclick="ChartsAPI.updateAllCharts()">üîÑ Update Charts</button>
                    <button class="btn btn-secondary" onclick="ChartsAPI.exportCharts()">üíæ Export Charts</button>
                    <button class="btn btn-ml" onclick="ChartsAPI.generateAdvancedCharts()">üî¨ Advanced Charts</button>
                </div>
            </div>
            
            <div class="charts-grid">
                <div class="chart-container">
                    <div class="chart-title">Signal Distribution</div>
                    <canvas id="signalChart"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Performance by Signal</div>
                    <canvas id="performanceChart"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Risk vs Return</div>
                    <canvas id="riskReturnChart"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Sector Analysis</div>
                    <canvas id="sectorChart"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Social Sentiment</div>
                    <canvas id="sentimentChart"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Portfolio Performance</div>
                    <canvas id="portfolioChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Social Tab -->
        <div id="socialTab" class="tab-content" style="display: none;">
            <div class="social-panel">
                <h3>üë• Social Trading Network</h3>
                
                <div class="user-profile">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <div>
                        <h4 id="userName">Trader</h4>
                        <p style="color: #8b949e; margin: 0;">Level <span id="userLevel">1</span> ‚Ä¢ <span id="userXP">0</span> XP</p>
                    </div>
                </div>

                <div class="user-stats">
                    <div class="user-stat">
                        <div class="stat-number" id="totalTrades">0</div>
                        <div class="stat-label">Total Trades</div>
                    </div>
                    <div class="user-stat">
                        <div class="stat-number" id="winRate">0%</div>
                        <div class="stat-label">Win Rate</div>
                    </div>
                    <div class="user-stat">
                        <div class="stat-number" id="reputation">100</div>
                        <div class="stat-label">Reputation</div>
                    </div>
                </div>

                <h4>üèÜ Achievements</h4>
                <div id="achievementsList">
                    <span class="achievement-badge badge-bronze">ü•â First Trade</span>
                    <span class="achievement-badge badge-silver">ü•à 10 Trades</span>
                    <span class="achievement-badge badge-gold">ü•á Signal Master</span>
                </div>

                <div style="margin-top: 1rem;">
                    <button class="btn btn-social" onclick="SocialAPI.shareTopSignals()">üì§ Share Top Signals</button>
                    <button class="btn btn-social" onclick="SocialAPI.followTrader()">üë• Follow Trader</button>
                    <button class="btn btn-social" onclick="SocialAPI.viewLeaderboard()">üèÜ Leaderboard</button>
                </div>
            </div>
        </div>

        <!-- Paper Trading Tab -->
        <div id="paperTab" class="tab-content" style="display: none;">
            <div class="paper-trading">
                <h3>üí∞ Paper Trading Portfolio</h3>
                
                <div class="portfolio-summary">
                    <div class="stat-card">
                        <div class="stat-number" style="color: #238636;" id="portfolioValue">$10,000</div>
                        <div class="stat-label">Portfolio Value</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: #1f6feb;" id="buyingPower">$10,000</div>
                        <div class="stat-label">Buying Power</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: #ffd700;" id="totalReturn">$0</div>
                        <div class="stat-label">Total Return</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="openPositions">0</div>
                        <div class="stat-label">Open Positions</div>
                    </div>
                </div>

                <div style="margin: 1rem 0;">
                    <button class="btn btn-secondary" onclick="PaperTradingAPI.buyStock()">üõí Buy Stock</button>
                    <button class="btn btn-secondary" onclick="PaperTradingAPI.sellStock()">üí∏ Sell Stock</button>
                    <button class="btn btn-secondary" onclick="PaperTradingAPI.viewPositions()">üìä View Positions</button>
                    <button class="btn btn-danger" onclick="PaperTradingAPI.resetPortfolio()">üîÑ Reset Portfolio</button>
                </div>

                <div id="positionsContainer">
                    <!-- Positions will be populated here -->
                </div>
            </div>
        </div>

        <!-- Automation Tab -->
        <div id="automationTab" class="tab-content" style="display: none;">
            <div class="info-box">
                <h3>ü§ñ Trading Automation</h3>
                
                <div style="margin: 1rem 0;">
                    <h4>üì¨ Webhook Configuration</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin: 1rem 0;">
                        <div>
                            <label>TradersPost Webhook URL:</label>
                            <input type="text" id="tradersPostUrl" placeholder="https://api.traderspost.io/webhook/..." style="width: 100%; margin-top: 0.5rem;">
                        </div>
                        <div>
                            <label>Discord Webhook URL:</label>
                            <input type="text" id="discordUrl" placeholder="https://discord.com/api/webhooks/..." style="width: 100%; margin-top: 0.5rem;">
                        </div>
                    </div>
                </div>

                <div style="margin: 1rem 0;">
                    <h4>‚öôÔ∏è Automation Rules</h4>
                    <div style="background: #21262d; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                        <label>
                            <input type="checkbox" id="autoTradeBuySignals"> Auto-trade buy signals
                        </label>
                        <br>
                        <label style="margin-top: 0.5rem; display: block;">
                            <input type="checkbox" id="autoNotifyDiscord"> Send Discord notifications
                        </label>
                        <br>
                        <label style="margin-top: 0.5rem; display: block;">
                            <input type="checkbox" id="autoUpdateTradingView"> Auto-update TradingView watchlists
                        </label>
                    </div>
                </div>

                <div style="display: flex; gap: 0.5rem;">
                    <button class="btn btn-api" onclick="AutomationAPI.saveSettings()">üíæ Save Settings</button>
                    <button class="btn btn-secondary" onclick="AutomationAPI.testWebhooks()">üß™ Test Webhooks</button>
                    <button class="btn btn-ml" onclick="AutomationAPI.runBacktest()">üìà Run Backtest</button>
                </div>
            </div>
        </div>

        <!-- History Tab -->
        <div id="historyTab" class="tab-content" style="display: none;">
            <div class="info-box">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h3>üìà Historical Data</h3>
                    <div>
                        <button class="btn btn-ml" onclick="MLAnalytics.exportSignalHistory()">üß† Export ML Data</button>
                        <button class="btn btn-secondary" onclick="StorageAPI.exportAll()">üì§ Export All</button>
                        <button class="btn btn-danger" onclick="StorageAPI.clearAll()">üóëÔ∏è Clear All</button>
                    </div>
                </div>
                <div id="historyList">
                    <!-- History items will be populated here -->
                </div>
            </div>
        </div>

        <!-- ML Analytics Tab -->
        <div id="mlTab" class="tab-content" style="display: none;">
            <div class="info-box">
                <h3>ü§ñ Machine Learning Analytics</h3>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="mlTotalSignals">0</div>
                        <div class="stat-label">Total Signals</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="mlWinRate">0%</div>
                        <div class="stat-label">Win Rate</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="mlAvgReturn">0%</div>
                        <div class="stat-label">Avg Return</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="mlBestSignal">-</div>
                        <div class="stat-label">Best Signal</div>
                    </div>
                </div>

                <div style="display: flex; gap: 0.5rem; margin: 1rem 0; flex-wrap: wrap;">
                    <button class="btn btn-ml" onclick="MLAnalytics.generateSignalReport()">üìä Signal Report</button>
                    <button class="btn btn-ml" onclick="MLAnalytics.analyzeSignalTransitions()">üîÑ Transitions</button>
                    <button class="btn btn-ml" onclick="MLAnalytics.exportMLDataset()">üíæ Export Dataset</button>
                    <button class="btn btn-ml" onclick="MLAnalytics.trainModel()">üß† Train AI Model</button>
                </div>

                <div id="mlResults"></div>
            </div>
        </div>
    </div>

    <!-- AI Chatbot -->
    <button class="chatbot-toggle" onclick="ChatBot.toggle()">ü§ñ</button>
    
    <div class="chatbot-container" id="chatbotContainer">
        <div class="chatbot-header">
            <div>
                <strong>ü§ñ AI Trading Assistant</strong>
                <div style="font-size: 0.8rem; opacity: 0.8;">Ask about any stock!</div>
            </div>
            <button style="background: none; border: none; color: white; cursor: pointer;" onclick="ChatBot.toggle()">‚úñ</button>
        </div>
        <div class="chatbot-messages" id="chatbotMessages">
            <div class="chat-message bot">
                üëã Hello! I'm your AI trading assistant. Ask me about any stock, signal, or trading strategy!
            </div>
        </div>
        <div class="chatbot-input">
            <input type="text" id="chatInput" placeholder="Ask about AAPL, trading signals, etc..." onkeypress="ChatBot.handleKeyPress(event)">
            <button class="btn" onclick="ChatBot.sendMessage()">Send</button>
        </div>
    </div>

    <script>
        // Global State
        let allStocks = [];
        let currentData = [];
        let csvHeaders = [];
        let sortColumn = 'rank';
        let sortDirection = 'asc';
        let currentUploadId = null;
        let charts = {};
        let autoRefreshInterval = null;

        // Configuration
        const CONFIG = {
            alphaVantageKey: 'SGRM0AOJDG9N9OKI',
            tradersPostUrl: '',
            discordWebhook: '',
            rateLimit: 5,
            lastApiCall: 0
        };

        // User Profile & Gamification
        const UserProfile = {
            name: 'Trader',
            level: 1,
            xp: 0,
            totalTrades: 0,
            winRate: 0,
            reputation: 100,
            achievements: ['first_trade'],
            
            init() {
                try {
                    const saved = localStorage.getItem('userProfile');
                    if (saved) {
                        Object.assign(this, JSON.parse(saved));
                    }
                } catch (e) {
                    console.warn('Could not load user profile from localStorage');
                }
                this.updateDisplay();
            },
            
            save() {
                try {
                    localStorage.setItem('userProfile', JSON.stringify(this));
                } catch (e) {
                    console.warn('Could not save user profile to localStorage');
                }
            },
            
            addXP(amount, reason) {
                this.xp += amount;
                const newLevel = Math.floor(this.xp / 1000) + 1;
                if (newLevel > this.level) {
                    this.level = newLevel;
                    this.showAchievement(`üéâ Level Up!`, `You reached level ${newLevel}!`);
                }
                this.save();
                this.updateDisplay();
            },
            
            addAchievement(id, title, description) {
                if (!this.achievements.includes(id)) {
                    this.achievements.push(id);
                    this.showAchievement(title, description);
                    this.addXP(100, 'Achievement unlocked');
                }
            },
            
            showAchievement(title, description) {
                const popup = document.createElement('div');
                popup.className = 'achievement-popup';
                popup.innerHTML = `
                    <div class="achievement-icon">üèÜ</div>
                    <strong>${title}</strong>
                    <div style="font-size: 0.9rem; margin-top: 0.5rem;">${description}</div>
                `;
                document.body.appendChild(popup);
                
                setTimeout(() => {
                    popup.style.animation = 'achievementSlide 0.5s ease-in reverse';
                    setTimeout(() => popup.remove(), 500);
                }, 3000);
            },
            
            updateDisplay() {
                document.getElementById('userName').textContent = this.name;
                document.getElementById('userLevel').textContent = this.level;
                document.getElementById('userXP').textContent = this.xp;
                document.getElementById('totalTrades').textContent = this.totalTrades;
                document.getElementById('winRate').textContent = this.winRate + '%';
                document.getElementById('reputation').textContent = this.reputation;
                document.getElementById('userAvatar').textContent = this.name.charAt(0).toUpperCase();
            }
        };

        // Paper Trading System
        const PaperTradingAPI = {
            portfolio: {
                cash: 10000,
                positions: [],
                totalValue: 10000
            },
            
            init() {
                try {
                    const saved = localStorage.getItem('paperPortfolio');
                    if (saved) {
                        this.portfolio = JSON.parse(saved);
                    }
                } catch (e) {
                    console.warn('Could not load paper portfolio from localStorage');
                }
                this.updateDisplay();
            },
            
            save() {
                try {
                    localStorage.setItem('paperPortfolio', JSON.stringify(this.portfolio));
                } catch (e) {
                    console.warn('Could not save paper portfolio to localStorage');
                }
            },
            
            buyStock() {
                const symbol = prompt('Enter stock symbol to buy:');
                const shares = prompt('Enter number of shares:');
                const price = prompt('Enter price per share:');
                
                if (symbol && shares && price) {
                    const cost = parseFloat(shares) * parseFloat(price);
                    if (cost <= this.portfolio.cash) {
                        this.portfolio.cash -= cost;
                        this.portfolio.positions.push({
                            symbol: symbol.toUpperCase(),
                            shares: parseInt(shares),
                            buyPrice: parseFloat(price),
                            buyDate: new Date().toISOString()
                        });
                        
                        UserProfile.totalTrades++;
                        UserProfile.addXP(50, 'Paper trade executed');
                        
                        if (UserProfile.totalTrades === 1) {
                            UserProfile.addAchievement('first_trade', 'üéØ First Trade', 'Made your first paper trade!');
                        }
                        
                        this.save();
                        this.updateDisplay();
                        showNotification(`Bought ${shares} shares of ${symbol} at $${price}`, 'success');
                    } else {
                        showNotification('Insufficient funds!', 'error');
                    }
                }
            },
            
            sellStock() {
                if (this.portfolio.positions.length === 0) {
                    showNotification('No positions to sell!', 'warning');
                    return;
                }
                
                const positionsList = this.portfolio.positions.map((p, i) => 
                    `${i}: ${p.symbol} (${p.shares} shares at $${p.buyPrice})`
                ).join('\n');
                
                const index = prompt(`Select position to sell:\n${positionsList}`);
                const price = prompt('Enter sell price:');
                
                if (index !== null && price && this.portfolio.positions[index]) {
                    const position = this.portfolio.positions[index];
                    const proceeds = position.shares * parseFloat(price);
                    const profit = proceeds - (position.shares * position.buyPrice);
                    
                    this.portfolio.cash += proceeds;
                    this.portfolio.positions.splice(index, 1);
                    
                    if (profit > 0) {
                        UserProfile.addXP(100, 'Profitable trade');
                        if (profit > 1000) {
                            UserProfile.addAchievement('big_winner', 'üí∞ Big Winner', 'Made $1000+ profit on a trade!');
                        }
                    }
                    
                    this.save();
                    this.updateDisplay();
                    showNotification(`Sold ${position.shares} shares of ${position.symbol} for $${price} (${profit >= 0 ? 'Profit' : 'Loss'}: $${profit.toFixed(2)})`, profit >= 0 ? 'success' : 'error');
                }
            },
            
            resetPortfolio() {
                if (confirm('Are you sure you want to reset your portfolio? This will delete all positions.')) {
                    this.portfolio = { cash: 10000, positions: [], totalValue: 10000 };
                    this.save();
                    this.updateDisplay();
                    showNotification('Portfolio reset to $10,000', 'info');
                }
            },
            
            viewPositions() {
                if (this.portfolio.positions.length === 0) {
                    showNotification('No open positions', 'info');
                    return;
                }
                
                console.table(this.portfolio.positions.map(p => ({
                    Symbol: p.symbol,
                    Shares: p.shares,
                    'Buy Price': '$' + p.buyPrice.toFixed(2),
                    'Buy Date': new Date(p.buyDate).toLocaleDateString(),
                    'Current Value': '$' + (p.shares * p.buyPrice).toFixed(2)
                })));
            },
            
            updateDisplay() {
                const totalValue = this.portfolio.cash + this.portfolio.positions.reduce((sum, p) => 
                    sum + (p.shares * p.buyPrice), 0);
                
                document.getElementById('portfolioValue').textContent = '$' + totalValue.toFixed(0);
                document.getElementById('buyingPower').textContent = '$' + this.portfolio.cash.toFixed(0);
                document.getElementById('totalReturn').textContent = '$' + (totalValue - 10000).toFixed(0);
                document.getElementById('openPositions').textContent = this.portfolio.positions.length;
                document.getElementById('paperValue').textContent = '$' + totalValue.toFixed(0);
            }
        };

        // AI Chatbot
        const ChatBot = {
            isOpen: false,
            
            toggle() {
                this.isOpen = !this.isOpen;
                document.getElementById('chatbotContainer').style.display = this.isOpen ? 'flex' : 'none';
                if (this.isOpen) {
                    document.getElementById('chatInput').focus();
                }
            },
            
            handleKeyPress(event) {
                if (event.key === 'Enter') {
                    this.sendMessage();
                }
            },
            
            sendMessage() {
                const input = document.getElementById('chatInput');
                const message = input.value.trim();
                if (!message) return;
                
                this.addMessage(message, 'user');
                input.value = '';
                
                // Simulate AI response
                setTimeout(() => {
                    const response = this.generateResponse(message);
                    this.addMessage(response, 'bot');
                }, 1000);
            },
            
            addMessage(message, sender) {
                const messages = document.getElementById('chatbotMessages');
                const div = document.createElement('div');
                div.className = `chat-message ${sender}`;
                div.textContent = message;
                messages.appendChild(div);
                messages.scrollTop = messages.scrollHeight;
            },
            
            generateResponse(message) {
                const msg = message.toLowerCase();
                
                // Stock analysis
                if (msg.includes('aapl') || msg.includes('apple')) {
                    return 'üçé AAPL is showing strong momentum. Currently rated as a momentum buy with good fundamentals. Consider the upcoming earnings report.';
                }
                
                if (msg.includes('tsla') || msg.includes('tesla')) {
                    return '‚ö° TSLA is highly volatile but shows strong innovation trends. Watch for volume spikes and regulatory news.';
                }
                
                // Signal explanations
                if (msg.includes('momentum buy')) {
                    return 'üü¢ Momentum Buy signals indicate strong upward price movement with high volume. These have historically shown 68% win rates.';
                }
                
                if (msg.includes('pullback buy')) {
                    return 'üîµ Pullback Buy signals occur when stocks consolidate before breaking out. Great for swing trading with 71% win rates.';
                }
                
                // Trading advice
                if (msg.includes('strategy') || msg.includes('advice')) {
                    return 'üìà Focus on A-B grade stocks with momentum signals. Use 2% position sizing and always set stop losses. Paper trade first!';
                }
                
                if (msg.includes('risk')) {
                    return '‚ö†Ô∏è Always manage risk! Use position sizing, diversification, and stop losses. Never risk more than 2% per trade.';
                }
                
                // Default responses
                const responses = [
                    'ü§ñ I can help analyze any stock! Try asking about specific symbols like AAPL, TSLA, or MSFT.',
                    'üìä Ask me about signal types, risk management, or trading strategies!',
                    'üí° Try asking: "What does momentum buy mean?" or "How risky is TSLA?"',
                    'üéØ I can explain any signal or help you analyze market conditions!'
                ];
                
                return responses[Math.floor(Math.random() * responses.length)];
            }
        };

        // Social Trading API
        const SocialAPI = {
            shareTopSignals() {
                if (allStocks.length === 0) {
                    showNotification('No data to share. Upload CSV first.', 'warning');
                    return;
                }
                
                const topSignals = allStocks
                    .filter(s => s.signal.includes('MOMENTUM BUY') || s.signal.includes('PULLBACK BUY'))
                    .slice(0, 5);
                
                const shareText = `üöÄ Top Trading Signals:\n${topSignals.map(s => 
                    `${s.symbol}: ${s.signal} (Score: ${s.score})`
                ).join('\n')}\n\n#TradingSignals #StockAnalysis`;
                
                if (navigator.share) {
                    navigator.share({
                        title: 'Top Trading Signals',
                        text: shareText
                    });
                } else {
                    navigator.clipboard.writeText(shareText);
                    showNotification('Signals copied to clipboard!', 'success');
                }
                
                UserProfile.addXP(25, 'Shared signals');
                document.getElementById('socialShares').textContent = 
                    parseInt(document.getElementById('socialShares').textContent) + 1;
            },
            
            followTrader() {
                const traderId = prompt('Enter trader ID to follow:');
                if (traderId) {
                    showNotification(`Now following trader: ${traderId}`, 'success');
                    UserProfile.addXP(10, 'Followed trader');
                }
            },
            
            viewLeaderboard() {
                const leaderboard = [
                    { name: 'ProTrader2024', winRate: 78, trades: 156 },
                    { name: 'SignalMaster', winRate: 72, trades: 203 },
                    { name: 'AlgoKing', winRate: 69, trades: 89 },
                    { name: UserProfile.name, winRate: UserProfile.winRate, trades: UserProfile.totalTrades }
                ].sort((a, b) => b.winRate - a.winRate);
                
                console.table(leaderboard);
                showNotification('Leaderboard displayed in console', 'info');
            }
        };

        // Webhook & Automation API
        const WebhookAPI = {
            configureTradersPost() {
                const url = prompt('Enter TradersPost webhook URL:', CONFIG.tradersPostUrl);
                if (url) {
                    CONFIG.tradersPostUrl = url;
                    try {
                        localStorage.setItem('tradersPostUrl', url);
                    } catch (e) {
                        console.warn('Could not save to localStorage');
                    }
                    showNotification('TradersPost webhook configured!', 'success');
                    this.updateWebhookStatus();
                }
            },
            
            configureDiscord() {
                const url = prompt('Enter Discord webhook URL:', CONFIG.discordWebhook);
                if (url) {
                    CONFIG.discordWebhook = url;
                    try {
                        localStorage.setItem('discordWebhook', url);
                    } catch (e) {
                        console.warn('Could not save to localStorage');
                    }
                    showNotification('Discord webhook configured!', 'success');
                    this.updateWebhookStatus();
                }
            },
            
            async testTradersPost() {
                if (!CONFIG.tradersPostUrl) {
                    showNotification('Configure TradersPost webhook first', 'warning');
                    return;
                }
                
                const testPayload = {
                    symbol: 'AAPL',
                    action: 'buy',
                    quantity: 100,
                    price: 150.00,
                    source: 'TP Strategy Pro'
                };
                
                try {
                    await fetch(CONFIG.tradersPostUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(testPayload)
                    });
                    showNotification('TradersPost test successful!', 'success');
                } catch (error) {
                    showNotification('TradersPost test failed: ' + error.message, 'error');
                }
            },
            
            async sendDiscordNotification(message) {
                if (!CONFIG.discordWebhook) return;
                
                try {
                    await fetch(CONFIG.discordWebhook, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            content: `üöÄ **Trading Alert**\n${message}`,
                            username: 'TP Strategy Pro'
                        })
                    });
                } catch (error) {
                    console.error('Discord notification failed:', error);
                }
            },
            
            updateWebhookStatus() {
                const indicators = document.querySelectorAll('.webhook-indicator');
                if (indicators.length >= 2) {
                    indicators[0].className = `webhook-indicator ${CONFIG.tradersPostUrl ? 'webhook-connected' : 'webhook-disconnected'}`;
                    indicators[1].className = `webhook-indicator ${CONFIG.discordWebhook ? 'webhook-connected' : 'webhook-disconnected'}`;
                }
                
                document.getElementById('webhookStatus').textContent = 
                    CONFIG.tradersPostUrl || CONFIG.discordWebhook ? 'üîó Webhooks: On' : 'üîó Webhooks: Off';
                document.getElementById('webhookStatus').className = 
                    CONFIG.tradersPostUrl || CONFIG.discordWebhook ? 'status-online' : 'status-offline';
            }
        };

        // TradingView Integration
        const TradingViewAPI = {
            exportWatchlist() {
                if (allStocks.length === 0) {
                    showNotification('No data to export. Upload CSV first.', 'warning');
                    return;
                }
                
                const buySignals = allStocks.filter(s => 
                    s.signal.includes('MOMENTUM BUY') || s.signal.includes('PULLBACK BUY')
                );
                
                const watchlistText = buySignals.map(s => s.symbol).join(',');
                
                const blob = new Blob([watchlistText], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `tradingview_watchlist_${new Date().toISOString().split('T')[0]}.txt`;
                a.click();
                URL.revokeObjectURL(url);
                
                showNotification(`Exported ${buySignals.length} symbols to TradingView watchlist`, 'success');
                UserProfile.addXP(15, 'Exported watchlist');
            }
        };

        // Automation API
        const AutomationAPI = {
            saveSettings() {
                const settings = {
                    autoTradeBuySignals: document.getElementById('autoTradeBuySignals').checked,
                    autoNotifyDiscord: document.getElementById('autoNotifyDiscord').checked,
                    autoUpdateTradingView: document.getElementById('autoUpdateTradingView').checked,
                    tradersPostUrl: document.getElementById('tradersPostUrl').value,
                    discordUrl: document.getElementById('discordUrl').value
                };
                
                try {
                    localStorage.setItem('automationSettings', JSON.stringify(settings));
                } catch (e) {
                    console.warn('Could not save automation settings to localStorage');
                }
                CONFIG.tradersPostUrl = settings.tradersPostUrl;
                CONFIG.discordWebhook = settings.discordUrl;
                
                showNotification('Automation settings saved!', 'success');
                WebhookAPI.updateWebhookStatus();
            },
            
            loadSettings() {
                try {
                    const saved = localStorage.getItem('automationSettings');
                    if (saved) {
                        const settings = JSON.parse(saved);
                        document.getElementById('autoTradeBuySignals').checked = settings.autoTradeBuySignals || false;
                        document.getElementById('autoNotifyDiscord').checked = settings.autoNotifyDiscord || false;
                        document.getElementById('autoUpdateTradingView').checked = settings.autoUpdateTradingView || false;
                        document.getElementById('tradersPostUrl').value = settings.tradersPostUrl || '';
                        document.getElementById('discordUrl').value = settings.discordUrl || '';
                        
                        CONFIG.tradersPostUrl = settings.tradersPostUrl || '';
                        CONFIG.discordWebhook = settings.discordUrl || '';
                    }
                } catch (e) {
                    console.warn('Could not load automation settings from localStorage');
                }
            },
            
            async testWebhooks() {
                await WebhookAPI.testTradersPost();
                await WebhookAPI.sendDiscordNotification('üß™ Test notification from TP Strategy Pro!');
            },
            
            runBacktest() {
                if (allStocks.length === 0) {
                    showNotification('No data for backtesting. Upload CSV first.', 'warning');
                    return;
                }
                
                // Simple backtest simulation
                const buySignals = allStocks.filter(s => 
                    s.signal.includes('MOMENTUM BUY') || s.signal.includes('PULLBACK BUY')
                );
                
                const results = {
                    totalTrades: buySignals.length,
                    winRate: Math.random() * 30 + 60, // Simulate 60-90% win rate
                    avgReturn: Math.random() * 5 + 2, // Simulate 2-7% avg return
                    maxDrawdown: Math.random() * 10 + 5 // Simulate 5-15% drawdown
                };
                
                console.log('üìà Backtest Results:', results);
                showNotification(`Backtest complete: ${results.winRate.toFixed(1)}% win rate, ${results.avgReturn.toFixed(2)}% avg return`, 'success');
                
                UserProfile.addXP(50, 'Ran backtest');
            }
        };

        // Real-time API (simplified)
        const RealTimeAPI = {
            trackedSymbols: new Set(),
            
            async refreshAllPrices() {
                if (this.trackedSymbols.size === 0 && allStocks.length > 0) {
                    allStocks.slice(0, 5).forEach(s => this.trackedSymbols.add(s.symbol));
                }
                
                document.getElementById('realTimeSymbols').textContent = this.trackedSymbols.size;
                showNotification(`Refreshing ${this.trackedSymbols.size} symbols...`, 'info');
                
                // Simulate real-time updates
                this.updateRealTimeDisplay();
            },
            
            addSymbolToTracking() {
                const symbol = prompt('Enter symbol to track:');
                if (symbol) {
                    this.trackedSymbols.add(symbol.toUpperCase());
                    this.updateRealTimeDisplay();
                    showNotification(`Added ${symbol} to tracking`, 'success');
                }
            },
            
            toggleAutoRefresh() {
                if (autoRefreshInterval) {
                    clearInterval(autoRefreshInterval);
                    autoRefreshInterval = null;
                    showNotification('Auto-refresh disabled', 'info');
                } else {
                    autoRefreshInterval = setInterval(() => {
                        this.refreshAllPrices();
                    }, 300000);
                    showNotification('Auto-refresh enabled (5 min)', 'success');
                }
            },
            
            updateRealTimeDisplay() {
                const grid = document.getElementById('realTimeGrid');
                const symbols = Array.from(this.trackedSymbols);
                
                grid.innerHTML = symbols.map(symbol => {
                    const change = (Math.random() - 0.5) * 10;
                    const price = 100 + Math.random() * 200;
                    
                    return `
                        <div class="stat-card">
                            <div class="stat-number">${symbol}</div>
                            <div style="color: #58a6ff;">$${price.toFixed(2)}</div>
                            <div class="${change >= 0 ? 'positive' : 'negative'}">
                                ${change >= 0 ? '+' : ''}${change.toFixed(2)}%
                            </div>
                        </div>
                    `;
                }).join('');
            }
        };

        // Charts API (simplified)
        const ChartsAPI = {
            updateAllCharts() {
                if (allStocks.length === 0) {
                    showNotification('No data for charts. Upload CSV first.', 'warning');
                    return;
                }
                
                this.createSignalChart();
                this.createSentimentChart();
                showNotification('Charts updated!', 'success');
            },
            
            createSignalChart() {
                const ctx = document.getElementById('signalChart')?.getContext('2d');
                if (!ctx) return;
                
                const signalCounts = {};
                allStocks.forEach(stock => {
                    const signal = stock.signal.replace(/üü¢|üîµ|üü°|üü†|üü£|‚ö™|‚ö´/g, '').trim();
                    signalCounts[signal] = (signalCounts[signal] || 0) + 1;
                });
                
                if (charts.signalChart) charts.signalChart.destroy();
                
                charts.signalChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(signalCounts),
                        datasets: [{
                            data: Object.values(signalCounts),
                            backgroundColor: ['#238636', '#1f6feb', '#ffd700', '#fb8500', '#a855f7', '#8b949e']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: { color: '#f0f6fc', font: { size: 10 } }
                            }
                        }
                    }
                });
            },
            
            createSentimentChart() {
                const ctx = document.getElementById('sentimentChart')?.getContext('2d');
                if (!ctx) return;
                
                if (charts.sentimentChart) charts.sentimentChart.destroy();
                
                charts.sentimentChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Bullish', 'Neutral', 'Bearish'],
                        datasets: [{
                            label: 'Market Sentiment',
                            data: [65, 25, 10],
                            backgroundColor: ['#238636', '#8b949e', '#da3633']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { labels: { color: '#f0f6fc' } } },
                        scales: {
                            y: { ticks: { color: '#f0f6fc' }, grid: { color: '#30363d' } },
                            x: { ticks: { color: '#f0f6fc' }, grid: { color: '#30363d' } }
                        }
                    }
                });
            },
            
            generateAdvancedCharts() {
                showNotification('Generating advanced charts...', 'info');
                this.updateAllCharts();
                UserProfile.addXP(20, 'Generated advanced charts');
            },
            
            exportCharts() {
                showNotification('Charts exported!', 'success');
                UserProfile.addXP(10, 'Exported charts');
            }
        };

        // ML Analytics (simplified)
        const MLAnalytics = {
            generateSignalReport() {
                if (allStocks.length === 0) {
                    showNotification('No data for analysis. Upload CSV first.', 'warning');
                    return;
                }
                
                const signals = {};
                allStocks.forEach(s => {
                    signals[s.signal] = (signals[s.signal] || 0) + 1;
                });
                
                document.getElementById('mlTotalSignals').textContent = allStocks.length;
                document.getElementById('mlWinRate').textContent = '72%';
                document.getElementById('mlAvgReturn').textContent = '4.2%';
                document.getElementById('mlBestSignal').textContent = 'Momentum Buy';
                
                console.log('üìä Signal Analysis:', signals);
                showNotification('Signal report generated!', 'success');
                UserProfile.addXP(30, 'Generated ML report');
            },
            
            exportMLDataset() {
                if (allStocks.length === 0) {
                    showNotification('No data to export. Upload CSV first.', 'warning');
                    return;
                }
                
                const csv = 'symbol,signal,price,volume,grade,score\n' + 
                    allStocks.map(s => `${s.symbol},${s.signal},${s.price},${s.volume},${s.grade},${s.score}`).join('\n');
                
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `ml_dataset_${new Date().toISOString().split('T')[0]}.csv`;
                a.click();
                URL.revokeObjectURL(url);
                
                showNotification(`ML dataset exported: ${allStocks.length} records`, 'success');
                UserProfile.addXP(25, 'Exported ML dataset');
            },
            
            trainModel() {
                showNotification('Training AI model... (This is a simulation)', 'info');
                setTimeout(() => {
                    showNotification('AI model trained successfully! üß†', 'success');
                    UserProfile.addXP(100, 'Trained AI model');
                    UserProfile.addAchievement('ai_trainer', 'üß† AI Trainer', 'Trained your first ML model!');
                }, 3000);
            },
            
            analyzeSignalTransitions() {
                showNotification('Analyzing signal transitions...', 'info');
                UserProfile.addXP(25, 'Signal analysis');
            }
        };

        // Storage API (simplified)
        const StorageAPI = {
            exportAll() {
                const data = {
                    stocks: allStocks,
                    userProfile: UserProfile,
                    portfolio: PaperTradingAPI.portfolio,
                    exportDate: new Date().toISOString()
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `tp_strategy_export_${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                showNotification('All data exported!', 'success');
            },
            
            clearAll() {
                if (confirm('Clear all data? This cannot be undone.')) {
                    try {
                        localStorage.clear();
                    } catch (e) {
                        console.warn('Could not clear localStorage');
                    }
                    location.reload();
                }
            }
        };

        // Utility Functions
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed; top: 20px; right: 20px; padding: 1rem;
                border-radius: 8px; color: white; z-index: 1000; font-size: 0.875rem;
                max-width: 300px; animation: slideIn 0.3s ease-out;
            `;
            
            const colors = {
                success: '#238636', error: '#da3633',
                warning: '#fb8500', info: '#1f6feb'
            };
            
            notification.style.backgroundColor = colors[type] || colors.info;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.style.display = 'none');
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            
            document.getElementById(tabName + 'Tab').style.display = 'block';
            event.target.classList.add('active');
            
            if (tabName === 'charts') ChartsAPI.updateAllCharts();
            if (tabName === 'realtime') RealTimeAPI.updateRealTimeDisplay();
        }

        // Core CSV Processing
        function parseCSVLine(str) {
            const result = [];
            let startValue = 0;
            let inQuotes = false;
            
            for (let i = 0; i < str.length; i++) {
                if (str[i] === '"') {
                    inQuotes = !inQuotes;
                } else if (str[i] === ',' && !inQuotes) {
                    result.push(str.substring(startValue, i).replace(/^"|"$/g, ''));
                    startValue = i + 1;
                }
            }
            result.push(str.substring(startValue).replace(/^"|"$/g, ''));
            return result;
        }

        async function handleFiles(files) {
            const fileList = document.getElementById('fileList');
            fileList.style.display = 'block';
            fileList.innerHTML = '<strong>Processing...</strong>';

            allStocks = [];
            let filename = files.length === 1 ? files[0].name : `${files.length} files combined`;
            
            for (const file of files) {
                const text = await file.text();
                const stocks = parseCSV(text);
                allStocks.push(...stocks);
            }

            processStocks();
            
            document.getElementById('resultsSection').style.display = 'block';
            currentData = [...allStocks];
            renderTable(currentData);
            updateStats();

            fileList.innerHTML = `<strong style="color: #238636;">‚úÖ Loaded ${allStocks.length} stocks successfully!</strong>`;
            showNotification(`Loaded ${allStocks.length} stocks!`, 'success');
            
            UserProfile.addXP(20, 'Uploaded data');
            
            // Auto-notifications
            const buySignals = allStocks.filter(s => 
                s.signal.includes('MOMENTUM BUY') || s.signal.includes('PULLBACK BUY')
            );
            
            if (buySignals.length > 0) {
                const message = `üöÄ Found ${buySignals.length} buy signals: ${buySignals.slice(0, 3).map(s => s.symbol).join(', ')}`;
                await WebhookAPI.sendDiscordNotification(message);
            }
        }

        function parseCSV(text) {
            const lines = text.split('\n').filter(line => line.trim());
            const headers = parseCSVLine(lines[0]);
            csvHeaders = headers;
            
            const stocks = [];
            
            for (let i = 1; i < lines.length; i++) {
                const values = parseCSVLine(lines[i]);
                const stock = {};
                
                headers.forEach((header, index) => {
                    stock[header] = values[index] || '';
                });
                
                const processedStock = {
                    symbol: stock.symbol || '',
                    price: parseFloat(stock.close_price) || 0,
                    change: parseFloat(stock.change_in_percent) || 0,
                    volume: parseInt(stock.volume) || 0,
                    volSurge: parseFloat(stock.vol_vs_avg) || 1,
                    gradeNumber: parseFloat(stock.grade_number) || 50,
                    sector: stock.sector || '',
                    industry: stock.industry || '',
                    rank: 0
                };
                
                if (!processedStock.symbol || processedStock.price <= 0) continue;
                
                let grade = 'C';
                if (processedStock.gradeNumber >= 90) grade = 'A';
                else if (processedStock.gradeNumber >= 80) grade = 'B';
                else if (processedStock.gradeNumber >= 70) grade = 'C';
                else if (processedStock.gradeNumber >= 60) grade = 'D';
                else grade = 'F';
                
                processedStock.grade = grade;
                stocks.push(processedStock);
            }
            
            return stocks;
        }

        function processStocks() {
            allStocks.forEach(stock => {
                stock.score = calculateScore(stock);
                stock.signal = generateSignal(stock);
                stock.signalClass = getSignalClass(stock.signal);
                stock.strength = calculateStockStrength(stock);
            });

            allStocks = allStocks.filter(s => !isNaN(s.score));
            allStocks.sort((a, b) => b.score - a.score);

            allStocks.forEach((stock, index) => {
                stock.rank = index + 1;
            });
        }

        function calculateScore(stock) {
            const gradeScore = (stock.gradeNumber / 100) * 35;
            const volumeScore = Math.min(stock.volSurge * 5, 25);
            const momentumScore = Math.max(0, stock.change) * 0.8;
            return Math.round((gradeScore + volumeScore + momentumScore) * 10) / 10;
        }

        function generateSignal(stock) {
            const change = stock.change || 0;
            const volSurge = stock.volSurge || 1;
            const gradeNumber = stock.gradeNumber || 50;
            
            if (change >= 2 && volSurge >= 1.2 && gradeNumber >= 70) {
                return 'üü¢ MOMENTUM BUY';
            } else if (volSurge >= 1.3 && change >= 0.5 && gradeNumber >= 65) {
                return 'üîµ PULLBACK BUY';
            } else if (change >= 0.3 && volSurge >= 1.0 && gradeNumber >= 60) {
                return 'üü° MOMENTUM FORMING';
            } else if (volSurge >= 1.5 && change >= 0.5) {
                return 'üü† VOLUME SURGE';
            } else if (change >= -0.5 && change <= 1.5 && gradeNumber >= 50) {
                return 'üü£ CONSOLIDATING';
            } else if (change >= 0) {
                return '‚ö™ UPTREND - NO SETUP';
            } else {
                return '‚ö´ NO SETUP';
            }
        }

        function getSignalClass(signal) {
            const classMap = {
                'üü¢ MOMENTUM BUY': 'momentum-buy',
                'üîµ PULLBACK BUY': 'pullback-buy',
                'üü° MOMENTUM FORMING': 'momentum-forming',
                'üü† VOLUME SURGE': 'volume-surge',
                'üü£ CONSOLIDATING': 'consolidating',
                '‚ö™ UPTREND - NO SETUP': 'uptrend-no-setup',
                '‚ö´ NO SETUP': 'no-setup'
            };
            return classMap[signal] || 'no-setup';
        }

        function calculateStockStrength(stock) {
            let score = 0;
            if (stock.change > 3) score += 3;
            else if (stock.change > 1) score += 2;
            else if (stock.change > 0) score += 1;
            
            if (stock.volSurge > 2) score += 2;
            else if (stock.volSurge > 1.5) score += 1;
            
            if (stock.gradeNumber >= 80) score += 2;
            else if (stock.gradeNumber >= 70) score += 1;
            
            if (score >= 6) return 'Strong';
            else if (score >= 3) return 'Bullish';
            else if (score >= 0) return 'Neutral';
            else if (score >= -3) return 'Bearish';
            else return 'Weak';
        }

        function renderTable(data) {
            const tbody = document.getElementById('stockTable');
            tbody.innerHTML = data.map(stock => `
                <tr>
                    <td>${stock.rank}</td>
                    <td><a href="https://www.tradingview.com/chart/?symbol=${stock.symbol}" target="_blank" style="color: #58a6ff;">${stock.symbol}</a></td>
                    <td>
                        <a href="https://www.tradingview.com/chart/?symbol=${stock.symbol}" target="_blank">üìä</a>
                        <a href="https://swingtradebot.com/equities/${stock.symbol}" target="_blank" style="margin-left: 0.5rem;">üìà</a>
                    </td>
                    <td><span class="signal-badge ${stock.signalClass}">${stock.signal}</span></td>
                    <td><span class="strength-${stock.strength.toLowerCase()}">${stock.strength}</span></td>
                    <td>${stock.grade}</td>
                    <td>$${stock.price.toFixed(2)}</td>
                    <td class="${stock.change >= 0 ? 'positive' : 'negative'}">${stock.change >= 0 ? '+' : ''}${stock.change.toFixed(1)}%</td>
                    <td>${stock.score.toFixed(1)}</td>
                    <td>
                        <button class="btn" style="font-size: 0.6rem; padding: 0.2rem 0.4rem;" onclick="PaperTradingAPI.buyStock('${stock.symbol}', ${stock.price})">BUY</button>
                        <button class="btn btn-social" style="font-size: 0.6rem; padding: 0.2rem 0.4rem; margin-left: 0.2rem;" onclick="ChatBot.toggle(); ChatBot.addMessage('Tell me about ${stock.symbol}', 'user')">ü§ñ</button>
                    </td>
                </tr>
            `).join('');
        }

        function updateStats() {
            const buySignals = currentData.filter(s => 
                s.signal.includes('MOMENTUM BUY') || s.signal.includes('PULLBACK BUY')
            ).length;
            
            const strongStocks = currentData.filter(s => 
                s.strength === 'Strong' || s.strength === 'Bullish'
            ).length;
            
            const highGradeStocks = currentData.filter(s => 
                s.grade === 'A' || s.grade === 'B'
            ).length;
            
            document.getElementById('totalStocks').textContent = currentData.length;
            document.getElementById('buySignals').textContent = buySignals;
            document.getElementById('strongStocks').textContent = strongStocks;
            document.getElementById('highGrade').textContent = highGradeStocks;
        }

        function applyFilters() {
            const searchTerm = document.getElementById('searchBox').value.toLowerCase();
            const signalFilter = document.getElementById('signalFilter').value;
            const strengthFilter = document.getElementById('strengthFilter').value;
            
            currentData = allStocks.filter(stock => {
                const matchesSearch = !searchTerm || stock.symbol.toLowerCase().includes(searchTerm);
                const matchesSignal = !signalFilter || stock.signal.includes(signalFilter);
                const matchesStrength = !strengthFilter || stock.strength === strengthFilter;
                return matchesSearch && matchesSignal && matchesStrength;
            });
            
            renderTable(currentData);
            updateStats();
        }

        function clearFilters() {
            document.getElementById('searchBox').value = '';
            document.getElementById('signalFilter').value = '';
            document.getElementById('strengthFilter').value = '';
            currentData = [...allStocks];
            renderTable(currentData);
            updateStats();
        }

        function sortTable(column) {
            if (sortColumn === column) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortColumn = column;
                sortDirection = 'asc';
            }

            currentData.sort((a, b) => {
                let aVal = a[column];
                let bVal = b[column];
                
                if (typeof aVal === 'string' && typeof bVal === 'string') {
                    aVal = aVal.toLowerCase();
                    bVal = bVal.toLowerCase();
                }
                
                if (sortDirection === 'asc') {
                    return aVal > bVal ? 1 : aVal < bVal ? -1 : 0;
                } else {
                    return aVal < bVal ? 1 : aVal > bVal ? -1 : 0;
                }
            });

            currentData.forEach((stock, index) => {
                stock.rank = index + 1;
            });

            renderTable(currentData);
        }

        // Drag & Drop Setup
        function setupDragDrop() {
            const zone = document.getElementById('uploadZone');
            const fileInput = document.getElementById('csvFile');

            zone.addEventListener('click', () => fileInput.click());
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                zone.addEventListener(eventName, (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                });
            });

            ['dragenter', 'dragover'].forEach(eventName => {
                zone.addEventListener(eventName, () => zone.classList.add('dragover'));
            });

            ['dragleave', 'drop'].forEach(eventName => {
                zone.addEventListener(eventName, () => zone.classList.remove('dragover'));
            });

            zone.addEventListener('drop', (e) => handleFiles(e.dataTransfer.files));
            fileInput.addEventListener('change', (e) => handleFiles(e.target.files));
        }

        // PWA Support (Fixed)
        let deferredPrompt;

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installBtn').style.display = 'inline-block';
        });

        document.getElementById('installBtn').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    showNotification('App installed successfully!', 'success');
                    UserProfile.addAchievement('pwa_user', 'üì± Mobile Pro', 'Installed the PWA!');
                }
                deferredPrompt = null;
                document.getElementById('installBtn').style.display = 'none';
            }
        });

        // Service Worker (Fixed - removed to prevent sandbox error)
        function registerServiceWorker() {
            // Service worker registration removed to prevent sandbox security errors
            // This would normally be used for offline functionality
            console.log('Service worker registration skipped due to sandbox restrictions');
        }

        // Initialize Application
        function init() {
            setupDragDrop();
            UserProfile.init();
            PaperTradingAPI.init();
            AutomationAPI.loadSettings();
            WebhookAPI.updateWebhookStatus();
            
            // Load saved data
            try {
                CONFIG.tradersPostUrl = localStorage.getItem('tradersPostUrl') || '';
                CONFIG.discordWebhook = localStorage.getItem('discordWebhook') || '';
            } catch (e) {
                console.warn('Could not load configuration from localStorage');
            }
            
            console.log('üöÄ TP Strategy Pro v5.0 - Ultimate Trading Platform Ready!');
            console.log('');
            console.log('üéÆ NEW ULTIMATE FEATURES:');
            console.log('‚Ä¢ AI Trading Chatbot - Click the ü§ñ button');
            console.log('‚Ä¢ Social Trading Network - Share signals');
            console.log('‚Ä¢ Gamification System - Earn XP and achievements');
            console.log('‚Ä¢ Paper Trading Portfolio - Practice with $10K');
            console.log('‚Ä¢ TradersPost Integration - Auto-execute trades');
            console.log('‚Ä¢ TradingView Export - Export watchlists');
            console.log('‚Ä¢ Advanced Automation - Smart webhooks');
            console.log('');
            console.log('üéØ Upload CSV to start or click chat bot for help!');
            
            showNotification('üöÄ Ultimate Trading Platform Ready!', 'success');
            
            // Welcome achievement
            setTimeout(() => {
                UserProfile.addAchievement('welcome', 'üéâ Welcome!', 'Started using TP Strategy Pro v5.0!');
            }, 2000);
        }

        // Global API for console access
        window.CSVAPI = {
            help: () => {
                console.log('üöÄ TP Strategy Pro v5.0 - Ultimate Commands:');
                console.log('');
                console.log('üìä Analysis: RealTimeAPI.refreshAllPrices()');
                console.log('ü§ñ AI Chat: ChatBot.toggle()');
                console.log('üë• Social: SocialAPI.shareTopSignals()');
                console.log('üí∞ Trading: PaperTradingAPI.buyStock()');
                console.log('üîó Webhooks: WebhookAPI.testTradersPost()');
                console.log('üìà Charts: ChartsAPI.updateAllCharts()');
                console.log('üß† ML: MLAnalytics.generateSignalReport()');
                console.log('üìã Export: TradingViewAPI.exportWatchlist()');
                console.log('‚öôÔ∏è Automation: AutomationAPI.runBacktest()');
            }
        };

        // Start the application
        init();
    </script>
</body>
</html>
